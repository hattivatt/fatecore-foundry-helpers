# Макросы-помощники для Fate Core Official в FoundryVTT

Набор макросов для FoundryVTT v12, предназначенных для облегчения ведения игр по системе **Fate Core Official**.

## Возможности

- **Ad-Hoc броски**: Быстрый бросок костей Fate для любой ситуации.
- **Менеджер Пунктов Судьбы (Fate Points)**: Визуальное отслеживание пунктов судьбы игроков и Мастера (ГМ) прямо на игровой сцене.
- **Виджеты персонажей**: Отображение ключевой информации о персонажах игроков (портрет, аспекты, навыки, стресс) на сцене.
- **Аспекты ситуации**: Удобное управление аспектами, действующими на сцене, с возможностью вывода их в виде виджета.
- **Вызовы и Состязания (Challenges and Contests)**: Создание и управление интерактивными списками для механик Вызовов и Состязаний.
- **Централизованная настройка**: Единый макрос для настройки всех остальных, с хранением параметров в журнале.

## Требования

- **FoundryVTT**: Версия 12
- **Игровая система**: [Fate Core Official](https://foundryvtt.com/packages/fate-core-official)
- **Модуль (опционально)**: [Advanced Drawing Tools](https://foundryvtt.com/packages/advanced-drawing-tools) - рекомендуется для лучшего визуального отображения текста в виджетах. Без него макросы будут работать, но текст может иметь тень.

## Установка и настройка

1.  **Скопируйте макросы**:
    -   Откройте директорию `macros` в этом репозитории.
    -   Для каждого `.js` файла создайте новый макрос в вашей игре FoundryVTT (тип "script").
    -   Скопируйте содержимое каждого файла в соответствующий макрос.

2.  **Первичная настройка**:
    -   Найдите макрос, который вы создали из файла `macros_settings.js` (например, назовите его "Настройки Макросов").
    -   **Запустите этот макрос.** Он автоматически создаст в журналах запись с названием "Настройки Макросов", где будут храниться все конфигурации.
    -   В появившемся диалоговом окне вы сможете поочередно выбрать каждый модуль (например, "Менеджер Фейт Поинтов") и настроить его параметры: пути к изображениям, координаты на сцене, размеры, шрифты и т.д.
    -   **Важно**: Для `FPManager` обязательно укажите путь к изображению, которое будет использоваться для отображения Пунктов Судьбы.

3.  **Готово!** Теперь вы можете вынести остальные макросы на панель и использовать их.

## Описание макросов

### Ad Hoc Roll (`ad_hoc_roll.js`)

Этот макрос открывает диалоговое окно для совершения произвольного броска, не привязанного к конкретному персонажу. Он полностью идентичен стандартной функции системы Fate Core Official, просто позволяет выполнять этот бросок из быстрого слота, не открывая Fate Utilities.

### FP Manager (`fp_manager.js`)

Управляет Жетонами Судьбы (FP) игроков и ГМ.

- **Функции**:
    -   **Синхронизировать всех**: Обновляет количество жетонов FP на столе в соответствии с текущими значениями в листах персонажей и настройках ГМ.
    -   **Рефреш всех**: Восстанавливает FP игроков до их значения `Refresh` и синхронизирует стол.
    -   **Дать/Забрать**: Позволяет изменять FP отдельных игроков или ГМ.
    -   **Новая сцена**: Устанавливает FP ГМ в соответствии с количеством игроков в сцене, очищает временный стресс у всех токенов на сцене и позволяет перенести ситуативные аспекты из прошлой сцены в новую.
- **Настройка**: Через макрос "Настройки Макросов" вы можете задать изображение для жетонов FP, их размер, а также стартовые позиции для жетонов каждого игрока и ГМ.

### Chars to Table (`chars_to_table.js`)

Создает и обновляет на сцене объекты с информацией из чарников персонажей игроков. Автоматически находит персонажей для которых у игроков стоят права owner, но поддерживает только трёх игроков и не больше одного персонажа для игрока.

- **Отображаемая информация**:
    -   Портрет персонажа
    -   Имя
    -   Аспекты
    -   Навыки (отсортированные по рангу)
    -   Трек физического стресса
- **Использование**: Просто запустите макрос. Он автоматически найдет персонажей игроков и создаст/обновит для них виджеты. Если у персонажа нет аспектов или используется стандартный портрет "mystery-man", его виджет будет очищен.
- **Настройка**: В настройках можно задать положение и размеры каждого элемента виджета (портрета, текста, навыков) для каждого из трех слотов игроков.

### Situation Aspects (`situation_aspects.js`)

Позволяет управлять ситуативными аспектами с помощью макроса (чуть удобнее чем в Fate Utilities) и кладёт все текущие аспекты в один текстовый объект с заданными координатами.

- **Функции**:
    -   Добавление, переименование и удаление аспектов.
    -   Изменение количества бесплатных призывов для каждого аспекта.
    -   Кнопка **"На стол"** создает или обновляет на сцене текстовый виджет, отображающий все текущие аспекты и их призывы.
- **Настройка**: Позволяет настроить положение, размер и шрифт для виджета аспектов.

### Challenges and Contests (`challenges_and_contests.js`)

Макрос для создания и управления механиками "Вызов" (Challenge) и "Состязание" (Contest).

- **При запуске**:
    -   Если не выделен ни один объект, макрос предложит создать новый Вызов или Состязание.
        -   **Вызов**: Вы указываете количество пунктов, их текст и сложность. Макрос создает на сцене текстовый объект со списком задач.
        -   **Состязание**: Вы указываете количество сторон и чекбоксов для каждой. Макрос создает несколько текстовых объектов.
    -   Если выделен текстовый объект, созданный этим макросом, он "отметит" следующий невыполненный пункт (заменит `[ ]` на `[X]`).
- **Настройка**: Можно настроить шрифт, размер текста и параметры фона для создаваемых объектов.

### Macros Settings (`macros_settings.js`)

Центр управления всеми настройками. При запуске предлагает выбрать, какой из модулей вы хотите настроить, после чего открывает диалог с соответствующими параметрами. Все изменения сохраняются в журнале "Настройки Макросов".
